<h1>Create an experiment!</h1>
<% partial("app/layouts/_logout.jl.html") %>

<div>
    <form id="exptype-form">
        <label>Stimulus Type:</label>
        <select name="type" id="type-ddl">
            <option value="default">Select a type</option>
            <% for_each(stimgen_types) do s 
                if s == type %>
                    <option value="$(s)" selected>$(s)</option>
                <% else %>
                    <option value="$(s)">$(s)</option>
                <% end
            end %>
        </select>
        <input id="exptype-submit" type="submit" value="Choose" disabled>
    </form>
</div>

<div>
    <form id="create-form">
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Field</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody id="experiment-settings">
                <% for_each(exp_fields) do f %>
                    <tr>
                        <td>$(f.label)</td>
                        <td> 
                            <% if f.step === nothing %> 
                                <input type="$(f.type)" name="experiment.$(f.name)" value="$(f.value)" required> 
                            <% else %>
                                <input type="$(f.type)" step="$(f.step)" name="experiment.$(f.name)" value="$(f.value)" required> 
                            <% end %>
                        </td>
                    </tr>
                <% end %>
            </tbody>
            <tbody id="stimgen-settings">
                <% if stimgen_fields !== nothing 
                    for_each(stimgen_fields) do s %>
                        <tr>
                            <td>$(s.label)</td>
                            <td> 
                            <% if s.step === nothing %> 
                                <input type="$(s.type)" name="experiment.$(s.name)" value="$(s.value)" required> 
                            <% else %>
                                <input type="$(s.type)" step="$(s.step)" name="experiment.$(s.name)" value="$(s.value)" required> 
                            <% end %>
                            </td>
                        </tr>
                    <% end 
                end %>
            </tbody>
        </table>
        <% if type !== nothing %>
            <input id="_type" type="hidden" name="_stimgen-type" value="$(type)">
            <input id="saveButton" type="submit" value="Save">
        <% else %>
            <input id="saveButton" type="submit" value="Save" disabled>
        <% end %>
    </form>
</div>

<div>
    <form action="/admin">
        <input style="margin-top:2px;" type="submit" value="Back to main page"></input>
    </form>
</div>

<script>
    document.addEventListener("submit", function(e) {
        if (e.target.getAttribute("id") == "exptype-form") {
            e.preventDefault();
            viewStimgen(e.target);
        } else if (e.target.getAttribute("id") == "create-form") {
            e.preventDefault();
            saveExperiment(e.target);
        }
    });

    const select = document.getElementById("type-ddl")
    const submitButton = document.getElementById("exptype-submit");
    select.addEventListener("change", () => {
        if (select.value === "default") {
            submitButton.disabled = true;
        } else {
            submitButton.disabled = false;
        }
    });
</script>
