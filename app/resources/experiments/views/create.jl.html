<h1>Create an experiment!</h1>
<% partial("app/layouts/_logout.jl.html") %>

<div>
    <form id="exptype-form">
        <label>Experiment Type:</label>
        <select name="type" id="type-ddl">
            <option value="default">Select a type</option>
            <% for_each(stimgen_types) do s %>
                <option value="$(s)">$(s)</option>
            <% end %>
        </select>
        <input id="exptype-submit" type="submit" value="Choose" disabled>
    </form>
</div>

<div>
    <form id="create-form">
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Field</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody id="experiment-settings">
                <% for_each(exp_fields) do f %>
                    <tr>
                        <td>$(f.label)</td>
                        <td> <input type="$(f.type)" name="experiment.$(f.name)" value="$(f.value)" required> </td>
                    </tr>
                <% end %>
            </tbody>
            <tbody id="stimgen-settings">
            </tbody>
        </table>
        <input type="submit" value="Save">
    </form>
</div>

<script>
    document.addEventListener("submit", function(e) {
        if (e.target.getAttribute('id') == 'exptype-form') {
            e.preventDefault();
            viewStimgen(e.target);
        } else if (e.target.getAttribute('id') == 'create-form') {
            e.preventDefault();
            console.log(e)
            console.log(e.target)
            console.log(e.target[0]);
            saveExperiment(e.target);
        }
    });

    const select = document.getElementById('type-ddl')
    const submitButton = document.getElementById('exptype-submit');
    select.addEventListener('change', () => {
        if (select.value === 'default') {
            submitButton.disabled = true;
        } else {
            submitButton.disabled = false;
        }
    });
</script>
